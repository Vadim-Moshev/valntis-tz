<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles/style.css" />
    <title>Тестовое задание для Валантис</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/md5.js"></script>
    <script src="scripts/api.js" defer></script>
    <script type="module">
      const LIMIT = 50;
      const state = {
        offset: 0,
      };

      const mkElem = (name, attributes, cssProps, textContent) => {
        const e = document.createElement(name);

        if (attributes) {
          for (const attributeName in attributes) {
            e[attributeName] = attributes[attributeName];
          }
        }

        if (cssProps) {
          for (const cssPropName in cssProps) {
            e.style[cssPropName] = cssProps[cssPropName];
          }
        }

        if (textContent) {
          e.textContent = textContent;
        }

        return e;
      };

      const post = async (body) => {
        const options = {
          method: "POST",
          headers: getHeaders(),
          body: JSON.stringify(body),
        };

        return await fetch(API_URL, options);
      };

      const getIDs = async (offset, limit) => {
        const params = { offset, limit };
        const body = {
          action: "get_ids",
          params,
        };

        const response = await post(body);
        const result = response.json();

        return result;
      };

      const response = await getIDs(state.offset, LIMIT);
      const products = new Set(response.result);

      if (products.size > 0) {
        const ol = mkElem("ol");

        for (const productItem of products) {
          let li = mkElem("li", null, null, productItem);
          ol.appendChild(li);
        };

        document.body.appendChild(ol);
      }
    </script>
  </head>
  <body></body>
</html>
